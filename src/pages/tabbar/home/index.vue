<template>
  <layout class="home">
    <view class="navbar">
      <Navbar :bgColor="'#a6ffcb'">
        <template #left>
          <view>
            <u-image :show-loading="true" :src="settings.homeNavimg" width="60" height="44px"></u-image>
          </view>
        </template>
        <template #right>
          <!-- #ifdef APP -->
          <u-icon name="scan" size="30" color="#000" @click="takephoto" :style="{ display: scan }"></u-icon>
          <!-- #endif -->
        </template>
      </Navbar>
    </view>
    <view class="banner">
      <banner></banner>
    </view>
    <view class="btn-group">
      <view class="btn-item" @click="routeto(item.url)" v-for="(item, index) in BtnItem" :key="index">
        <u-icon v-if='item.icon != ""' :name="item.icon" color="#2979ff" size="40"></u-icon>
        <view v-else-if="item.svg != ''" style="height: 40px;" v-html="item.svg"></view>
        <u-image v-else :src="item.img" shape="circle" width="80rpx" height="80rpx"></u-image>
        <text class="btn-text">{{ item.text }}</text>
      </view>
    </view>
    <u-gap height="20"></u-gap>
    <view class="news">
      <u-cell-group title="新闻" :customStyle="{ 'fontSize': '32rpx' }">
        <u-cell v-if="list.length > 0" isLink v-for="item in list" :key="item.nid">
          <template #title>
            <view class="img">
              <u-image :src="item.cover" width="100rpx" height="100rpx" lazyLoad />
            </view>
          </template>
          <template #value>
            <view class="text u-flex u-flex-direction-column">
              <text class="title">{{ item.title }}</text>
              <text class="describe">{{ item.description }}</text>
            </view>
          </template>
        </u-cell>
      </u-cell-group>
      <u-empty mode="news" text="暂无新闻" style="height: 400rpx;" :show="list.length == 0">
      </u-empty>
    </view>
    <u-toast ref="toast"></u-toast>
  </layout>
</template>

<script setup lang="ts">
import usePlatform from '@/store/platform'
import { reactive, ref, onMounted } from "vue"
import { onLoad, onReady } from "@dcloudio/uni-app"
import layout from "@/components/layout/index.vue"
import Navbar from "@/components/layout/navbar/navbar.vue"
import banner from "@/components/banner/banner.vue"
import request from '@/utils/request'
import showtoast from "@/utils/showtoast"
import { settings } from '@/settings/settings'
interface newsList {
  createTime: string
  updateTime: string
  createBy: string
  updateBy: string
  nid: Number
  slug: string
  title: string
  author: string
  content: string
  cover: string
  description: string
  views: Number
  published: boolean
  deleted: boolean
}
const toast = ref()
let src = ref()
let scan = ref("0")
const app = usePlatform()
let platform = app.getPlatform
let BtnItem = reactive([
  {
    id: 0,
    img: '',
    svg: '<svg t="1726378793858" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8119" width="40" height="40"><path d="M511.999488 64.021106c-247.27171 0-447.724091 200.452381-447.724091 447.724091s200.452381 447.724091 447.724091 447.724091 447.724091-200.453405 447.724091-447.724091S759.271198 64.021106 511.999488 64.021106zM720.771349 725.320457c-13.422707 13.670348-36.040844 20.25737-67.855434 19.761066l-57.663304 0c-44.407396 0-66.611094-24.855084-66.611094-74.566276L528.641517 534.807449l-55.923684 2.485611c-8.286734 114.00245-61.723783 187.239452-160.313196 219.718167-20.218484-27.507494-36.950564-48.88436-50.207495-64.126506 85.501326-23.692608 132.724861-74.315566 141.67265-151.862733-33.80185 2.155083-59.650565 4.393054-77.547167 6.711865l-25.849738-59.155285c36.948517-21.872147 75.722612-56.171324 116.321262-102.899578L270.152325 385.67899l0-65.617463 202.317868 0-17.895579-41.257659 72.576969-15.908318 23.362081 57.165977 194.863083 0 0 65.617463-238.358713 0c-29.495778 32.311917-62.222133 64.292282-98.175997 95.939049 46.560432-0.660032 109.361757-2.318812 188.400904-4.969175l-53.190433-52.195779 48.713468-37.779442c51.034327 44.077891 99.917664 88.98159 146.644895 134.714168l-51.201126 48.218188-37.282115-38.773072-52.693106 1.739621 0 126.014018c0 17.235546 8.78099 25.849738 26.346041 25.849738l19.386536 0c14.579043 0 24.191982-4.597715 28.831652-13.794168 4.637624-9.195429 8.947789-33.759895 12.925381-73.695442 18.555611 8.619308 41.756009 17.733896 69.594031 27.340695C745.707274 677.972079 734.19201 711.651133 720.771349 725.320457z" fill="#60ADFC" p-id="8120"></path></svg>',
    icon: '',
    text: '充值',
    url: ""
  },
  {
    id: 1,
    img: '',
    svg: '<svg t="1726378544512" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6685" width="40" height="40"><path d="M512 34.133333C249.173333 34.133333 34.133333 249.173333 34.133333 512s215.04 477.866667 477.866667 477.866667 477.866667-215.04 477.866667-477.866667S774.826667 34.133333 512 34.133333zM238.933333 308.906667c0-39.253333 30.72-69.973333 69.973334-69.973334H392.533333c18.773333 0 34.133333 15.36 34.133334 34.133334s-15.36 34.133333-34.133334 34.133333h-83.626666c-1.706667 0-1.706667 1.706667-1.706667 1.706667V392.533333c0 18.773333-15.36 34.133333-34.133333 34.133334s-34.133333-15.36-34.133334-34.133334v-83.626666zM392.533333 785.066667h-83.626666c-39.253333 0-69.973333-30.72-69.973334-69.973334V631.466667c0-18.773333 15.36-34.133333 34.133334-34.133334s34.133333 15.36 34.133333 34.133334v83.626666c0 1.706667 1.706667 1.706667 1.706667 1.706667H392.533333c18.773333 0 34.133333 15.36 34.133334 34.133333s-15.36 34.133333-34.133334 34.133334z m-66.56-238.933334c-18.773333 0-34.133333-15.36-34.133333-34.133333s15.36-34.133333 34.133333-34.133333h372.053334c18.773333 0 34.133333 15.36 34.133333 34.133333s-15.36 34.133333-34.133333 34.133333H325.973333zM785.066667 715.093333c0 39.253333-30.72 69.973333-69.973334 69.973334H631.466667c-18.773333 0-34.133333-15.36-34.133334-34.133334s15.36-34.133333 34.133334-34.133333h83.626666c1.706667 0 1.706667-1.706667 1.706667-1.706667V631.466667c0-18.773333 15.36-34.133333 34.133333-34.133334s34.133333 15.36 34.133334 34.133334v83.626666zM785.066667 392.533333c0 18.773333-15.36 34.133333-34.133334 34.133334s-34.133333-15.36-34.133333-34.133334v-83.626666c0-1.706667-1.706667-1.706667-1.706667-1.706667H631.466667c-18.773333 0-34.133333-15.36-34.133334-34.133333s15.36-34.133333 34.133334-34.133334h83.626666c39.253333 0 69.973333 30.72 69.973334 69.973334V392.533333z" fill="#60ADFC" p-id="6686"></path></svg>',
    icon: '',
    text: '扫一扫',
    url: ""
  },
  {
    id: 2,
    img: '',
    svg: '<svg t="1726378884683" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9272" width="40" height="40"><path d="M63.5 513.3c0 247.3 200.5 447.8 447.8 447.8s447.8-200.5 447.8-447.8S758.6 65.5 511.3 65.5 63.5 266 63.5 513.3z m567.3-18.2v38.7h-94.5v53.3h94.5v39.2h-94.5V704h-48.6v-77.6h-98v-39.2h98v-53.3h-98v-38.7h83.6L371.4 320h54.8c47.6 87 76.6 142.1 86.8 165.5h1c3.5-9.6 13-28.9 28.5-58L600.8 320h51.8L549.7 495.1h81.1z" fill="#60ADFC" p-id="9273"></path></svg>',
    icon: '',
    text: '卡余额',
    url: ""
  },
  {
    id: 3,
    img: '',
    svg: '<svg t="1726378940889" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="10715" width="40" height="40"><path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#9BD6FF" p-id="10716"></path><path d="M512 512m-460.8 0a460.8 460.8 0 1 0 921.6 0 460.8 460.8 0 1 0-921.6 0Z" fill="#2F86FF" p-id="10717"></path><path d="M448 537.6a46.08 46.08 0 0 1 46.08 46.08v102.4A46.08 46.08 0 0 1 448 732.16H345.6a46.08 46.08 0 0 1-46.08-46.08v-102.4A46.08 46.08 0 0 1 345.6 537.6z m102.4 76.8a20.48 20.48 0 0 1 20.3264 17.92l0.1536 2.56v76.8a20.48 20.48 0 0 1-40.8064 2.56l-0.1536-2.56v-76.8a20.48 20.48 0 0 1 20.48-20.48z m153.6 0a20.48 20.48 0 0 1 20.3264 17.92l0.1536 2.56v76.8a20.48 20.48 0 0 1-40.8064 2.56l-0.1536-2.56v-76.8a20.48 20.48 0 0 1 20.48-20.48z m-76.8 0a20.48 20.48 0 0 1 20.3264 17.92l0.1536 2.56v76.8a20.48 20.48 0 0 1-40.8064 2.56l-0.1536-2.56v-76.8a20.48 20.48 0 0 1 20.48-20.48z m-179.2-35.84H345.6a5.12 5.12 0 0 0-5.12 5.12v102.4c0 2.816 2.304 5.12 5.12 5.12h102.4a5.12 5.12 0 0 0 5.12-5.12v-102.4a5.12 5.12 0 0 0-5.12-5.12z m102.4-40.96a20.48 20.48 0 0 1 20.3264 17.92l0.1536 2.56v25.6a20.48 20.48 0 0 1-40.8064 2.56l-0.1536-2.56v-25.6a20.48 20.48 0 0 1 20.48-20.48z m153.6 0a20.48 20.48 0 0 1 20.3264 17.92l0.1536 2.56v25.6a20.48 20.48 0 0 1-40.8064 2.56l-0.1536-2.56v-25.6a20.48 20.48 0 0 1 20.48-20.48z m-76.8 0a20.48 20.48 0 0 1 20.3264 17.92l0.1536 2.56v25.6a20.48 20.48 0 0 1-40.8064 2.56l-0.1536-2.56v-25.6a20.48 20.48 0 0 1 20.48-20.48zM448 286.72A46.08 46.08 0 0 1 494.08 332.8v102.4A46.08 46.08 0 0 1 448 481.28H345.6A46.08 46.08 0 0 1 299.52 435.2V332.8A46.08 46.08 0 0 1 345.6 286.72z m230.4 0A46.08 46.08 0 0 1 724.48 332.8v102.4A46.08 46.08 0 0 1 678.4 481.28h-102.4A46.08 46.08 0 0 1 529.92 435.2V332.8A46.08 46.08 0 0 1 576 286.72zM448 327.68H345.6a5.12 5.12 0 0 0-5.12 5.12v102.4c0 2.816 2.304 5.12 5.12 5.12h102.4a5.12 5.12 0 0 0 5.12-5.12V332.8a5.12 5.12 0 0 0-5.12-5.12z m230.4 0h-102.4a5.12 5.12 0 0 0-5.12 5.12v102.4c0 2.816 2.304 5.12 5.12 5.12h102.4a5.12 5.12 0 0 0 5.12-5.12V332.8a5.12 5.12 0 0 0-5.12-5.12z" fill="#FFFFFF" p-id="10718"></path><path d="M396.8 384m-25.6 0a25.6 25.6 0 1 0 51.2 0 25.6 25.6 0 1 0-51.2 0Z" fill="#FFFFFF" p-id="10719"></path><path d="M396.8 640m-25.6 0a25.6 25.6 0 1 0 51.2 0 25.6 25.6 0 1 0-51.2 0Z" fill="#FFFFFF" p-id="10720"></path><path d="M627.2 384m-25.6 0a25.6 25.6 0 1 0 51.2 0 25.6 25.6 0 1 0-51.2 0Z" fill="#FFFFFF" p-id="10721"></path></svg>',
    icon: '',
    text: '付款码',
    url: "/pages/facialAuthentication/facialAuthentication"
  },
  {
    id: 4,
    img: '',
    svg: '<svg t="1726378980525" class="icon" viewBox="0 0 1117 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11834" width="40" height="40"><path d="M1032.192 116.968727a289.885091 289.885091 0 0 1 0 409.925818l-473.367273 473.367273h-0.558545L84.898909 526.894545a289.885091 289.885091 0 0 1 405.085091-414.72L558.545455 180.596364l63.674181-63.627637a289.885091 289.885091 0 0 1 409.972364 0z m-399.732364 172.264728c-6.097455-22.248727-37.841455-21.876364-43.426909 0.558545l-88.157091 354.210909-65.675636-159.883636a22.481455 22.481455 0 0 0-20.805818-13.917091H264.843636a22.481455 22.481455 0 0 0-22.434909 22.481454l0.093091 2.327273c1.163636 11.264 10.705455 20.107636 22.341818 20.107636h134.516364l86.016 209.361455 1.070545 2.187636c9.402182 17.687273 36.491636 14.894545 41.518546-5.306181l84.014545-337.594182 50.362182 182.830545 0.744727 2.234182a22.481455 22.481455 0 0 0 39.377455 4.654545l40.634182-58.368h109.242182a22.481455 22.481455 0 0 0 0-44.916363h-120.971637l-2.420363 0.139636a22.481455 22.481455 0 0 0-16.011637 9.495273l-20.014545 28.672-60.416-219.229091z" p-id="11835" fill="#60ADFC"></path></svg>',
    icon: '',
    text: '健康助手',
    url: "/pages/AIchat/AIchat"
  },
  {
    id: 5,
    img: '',
    svg: '<svg t="1726379078619" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15424" width="40" height="40"><path d="M512 512m-496.484848 0a496.484848 496.484848 0 1 0 992.969696 0 496.484848 496.484848 0 1 0-992.969696 0Z" fill="#DCF2FF" p-id="15425"></path><path d="M770.482424 644.499394l-143.825454-143.825455a195.490909 195.490909 0 0 0-266.24-240.950303l93.090909 93.090909a34.753939 34.753939 0 0 1 0 50.269091L403.393939 453.973333a34.753939 34.753939 0 0 1-50.269091 0l-93.090909-93.090909a195.490909 195.490909 0 0 0 240.64 265.619394l143.825455 143.825455a34.753939 34.753939 0 0 0 50.269091 0l75.558788-75.558788a34.753939 34.753939 0 0 0 0-50.269091z m-64.698182 61.129697a35.529697 35.529697 0 1 1 0-50.269091 34.753939 34.753939 0 0 1 0 50.269091z m0 0" fill="#2E9FFF" p-id="15426"></path></svg>',
    icon: '',
    text: '报修',
    url: ""
  },
  {
    id: 6,
    img: '',
    svg: '<svg t="1726379108731" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16764" width="40" height="40"><path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#59ACDD" p-id="16765"></path><path d="M708.076308 270.867692H676.627692c3.091692 5.395692 4.686769 11.500308 4.647385 17.723077v35.859693a35.446154 35.446154 0 0 1-34.323692 35.643076H359.108923a35.643077 35.643077 0 0 1-34.776615-35.643076v-35.879385a33.437538 33.437538 0 0 1 4.883692-17.723077H297.747692a71.522462 71.522462 0 0 0-71.522461 71.325538v357.159385a71.522462 71.522462 0 0 0 71.522461 70.852923h241.132308A160.748308 160.748308 0 0 1 779.815385 561.604923V342.173538a71.522462 71.522462 0 0 0-71.739077-71.305846zM495.064615 629.129846h-170.732307v-55.335384h170.732307v55.335384z m81.033847-119.788308H324.332308v-55.571692h251.766154v55.571692z" fill="#FFFFFF" p-id="16766"></path><path d="M437.720615 324.903385h142.808616a35.879385 35.879385 0 0 0 35.879384-35.643077v-35.66277a35.643077 35.643077 0 0 0-35.879384-35.643076h-142.808616a35.643077 35.643077 0 0 0-35.879384 35.643076v35.643077a35.879385 35.879385 0 0 0 35.879384 35.643077zM672.433231 556.504615a124.888615 124.888615 0 1 0 124.868923 125.105231 124.652308 124.652308 0 0 0-124.868923-125.105231z m71.286154 160.531693h-106.929231v-99.40677h35.643077V677.415385h71.286154v39.620923z" fill="#FFFFFF" p-id="16767"></path></svg>',
    icon: '',
    text: '请假',
    url: ""
  },
  {
    id: 7,
    img: '',
    svg: '<svg t="1726379131166" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="17834" width="40" height="40"><path d="M682.666667 577.6384h236.305066C988.9792 577.6384 1024 612.6592 1024 682.666667v236.305066C1024 988.9792 988.9792 1024 918.971733 1024H682.666667c-70.007467 0-105.028267-35.0208-105.028267-105.028267V682.666667c0-70.007467 35.0208-105.028267 105.028267-105.028267zM105.028267 0H341.333333c70.007467 0 105.028267 35.0208 105.028267 105.028267V341.333333c0 70.007467-35.0208 105.028267-105.028267 105.028267H105.028267C35.0208 446.3616 0 411.3408 0 341.333333V105.028267C0 35.0208 35.0208 0 105.028267 0z m0 577.6384H341.333333c70.007467 0 105.028267 35.0208 105.028267 105.028267v236.305066C446.3616 988.9792 411.3408 1024 341.333333 1024H105.028267C35.0208 1024 0 988.9792 0 918.971733V682.666667c0-70.007467 35.0208-105.028267 105.028267-105.028267z m620.9536-156.228267c34.133333 34.133333 87.9616 34.133333 122.094933 0l136.533333-137.8304c34.133333-34.133333 34.133333-87.9616 0-122.094933l-136.533333-136.533333c-32.802133-32.836267-87.9616-32.836267-120.832 0l-137.796267 136.533333c-34.133333 34.133333-34.133333 87.9616 0 122.094933l136.533334 137.8304z" fill="#60ADFC" p-id="17835"></path></svg>',
    icon: '',
    text: '更多',
    url: ""
  },
])
let list = ref<newsList[]>([
]
)
onReady(() => {
  getNews()
})
onMounted(() => {
  if (platform == 'h5') {

  } else if (platform == 'weixin' || platform == 'mp') {
    scan.value = 'none'
  } else if (platform == 'plus' || platform == 'nvue') {

  }
})
function takephoto() {
  uni.scanCode({
    onlyFromCamera: false,
    autoZoom: true,
    success: function (res) {
      console.log('条码类型：' + res.scanType);
      console.log('条码内容：' + res.result);
    },
    fail: function (res) {
      showtoast.onError(res.errMsg)
      console.log(res.errMsg)
    }
  });
}
function routeto(url: string) {
  uni.navigateTo({
    url: url
  })
}
function getNews() {
  request({
    url: '/news/list',
    method: 'get',
  }).then((res: any) => {
    if (res.success) {
      console.log(res.data)
      list.value = res.data
    } else {
      showtoast.onError(res.message)
    }
  }).catch((err) => {
    showtoast.onError(err)
  })
}
</script>

<style lang="scss" scoped>
.home {
  display: flex;
  flex-direction: column;
  background-color: $page-bg;

  .navbar {
    height: 150rpx;
  }

  .banner {
    height: 260rpx;
  }

  .btn-group {
    display: grid;
    height: 280rpx;
    grid-template-columns: 1fr 1fr 1fr 1fr;

    .btn-item {
      background-color: $moduleBackgroundColor;
      width: 100%;
      display: flex;
      align-items: center;
      flex-direction: column;

      .btn-text {
        width: 100%;
        text-align: center;
      }

      :deep(.u-image) {
        margin: 0 auto;
      }
    }
  }

  .news {
    background-color: $moduleBackgroundColor;

    :deep(.u-cell__body__content) {
      flex: none;
    }

    :deep(.u-cell-group__title) {
      padding: 16rpx 32rpx;
    }

    :deep(.u-cell-group__title__text) {
      font-weight: bold;
      font-size: 32rpx;
    }

    .img {}

    .text {
      margin-left: 20rpx;
      line-height: 1.5;
      display: flex;
      flex-direction: column;
      flex: 1;
      width: 70%;

      .title {
        font-size: 34rpx;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      .describe {
        font-size: 26rpx;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        color: $subtitle;
        width: auto;
      }
    }
  }
}
</style>
